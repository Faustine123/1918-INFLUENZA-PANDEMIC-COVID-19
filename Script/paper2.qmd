
---
title: "1918 Pandemic and COVID-19"
author: 
  - Myra Li
  - Randall Ni
  - Faustine Fan
thanks: "Code and data are available at: https://github.com/Faustine123/1918-INFLUENZA-PANDEMIC-COVID-19.git"
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "A"
output:
  bookdown::pdf_document2
toc: FALSE
bibliography: references.bib
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
library(tidyverse)
library(palmerpenguins)
library(dplyr)
library(tidyr)
library(readxl)
library(data.table)
library(lubridate)
library(haven)
library(readxl)
library(ggplot2)
raw_data_fig1<-read_dta(here::here("Input/Data/LOC_Newspapers_Sep18_Dec19.dta"))

```

```{r}

cleaned_figure1_data <-
  raw_data_fig1 |>
  # Select only certain columns
  select(
   flu_sep1_1918_dec31_1919,
   year,
   month,
   region
  )

### Clean data ###
# Rename column
cleaned_figure1_data <-
 cleaned_figure1_data |>
  rename(
    influence = flu_sep1_1918_dec31_1919
  )

#group by year, month, and region
cleaned_figure1_data<- cleaned_figure1_data %>%
  group_by(year, month, region) %>%
  summarize(total_influence = sum(influence)) %>%
  ungroup()

#create a new column to store date in month.year format
cleaned_figure1_data$date_label <- format(as.Date(paste(cleaned_figure1_data$year, cleaned_figure1_data$month, "01", sep = "-")), "%b.%Y")
cleaned_figure1_data$date_label <- factor(cleaned_figure1_data$date_label, levels = unique(cleaned_figure1_data$date_label))

#store cleaned data for figure 1
write.csv(cleaned_figure1_data, file = here::here("Output/Data/cleaned_figure1_data.csv"), row.names = FALSE)

### Draw graph ###
ggplot(cleaned_figure1_data, aes(x = date_label, y = total_influence, group = region, color = region)) +
  geom_line() +
  scale_x_discrete(labels = c("Sep.1918","", "Nov.1918","", "Jan.1919","","Mar.1919","", "May.1919","","Jul.1919","","Sep.1919","","Nov.1919","")) +
  labs(x = "Publication Month", y = "Articles mentioning influenza")

```

